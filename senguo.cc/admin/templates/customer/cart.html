{% extends 'base.html' %}
{% block title %}购物车{% end %}
{% block head %}
<link rel="stylesheet" href="{{static_url('css/market-cart.css')}}"/>
<link rel="stylesheet" href="{{static_url('css/fruit-color.css')}}"/>
{% end %}
{% block content %}
     <ul class="cart-list set-w100-fle box-shadow bg-white">
         {% for key in cart_f %}
         <li class="cart-list-item set-w100-fle fruit_item {{cart_f[key]['charge_type'].fruit.fruit_type.code}}">
             <div class="bg set-w100-fle color">
                 {% if cart_f[key]['charge_type'].fruit.img_url %}
                 <img src="{{cart_f[key]['charge_type'].fruit.img_url}}?imageView/1/w/100/h/100" class="goods-img pull-left w15 box-shadow"/>
                 {% else %}
                 <img src="/static/design_img/{{cart_f[key]['charge_type'].fruit.fruit_type.code}}.png" class="goods-img pull-left w15 box-shadow"/>
                 {% end %}
                 <div class="w10 pull-right delete-btn">
                     <a href="javascript:;" class="pull-right delete-item"></a>
                 </div>
                 <div class="goods-info pull-right w75 font14 p010">
                    <p>
                        <span class="name pull-left">{{cart_f[key]['charge_type'].fruit.name}}</span>
                        <span class="price pull-right">小记：<span class="item_total_price"></span>元</span>
                    </p>
                    <div class="charge-item">
                        <span class="col-sm-4  col-xs-4 text-bgcolor p0 charge-type" data-id="{{cart_f[key]['charge_type'].id}}">
                            <span class="item_price">{{cart_f[key]['charge_type'].price}}</span>
                            元/{{cart_f[key]['charge_type'].num}}
                            <span data-id="{{cart_f[key]['charge_type'].unit}}" class="chargeUnit"></span>
                        </span>
                        <span class="col-sm-6  col-xs-6  p0 number-change">
                            <a class="minus-plus text-orange bg-white pull-right number-plus" href="javascript:;">+</a>
                            <input type="text" value="{{cart_f[key]['num']}}" class="number-input pull-right text-orange item_number"/>
                            <a class="minus-plus text-orange bg-white pull-right number-minus" href="javascript:;">-</a>
                        </span>
                    </div>
                 </div>
             </div>
         </li>
         {% end %}
         {% for key in cart_m %}
         <li class="cart-list-item set-w100-fle menu_item TDSG">
             <div class="bg set-w100-fle color">
                 {% if cart_m[key]['mcharge_type'].mgoods.img_url %}
                 <img src="{{cart_m[key]['mcharge_type'].mgoods.img_url}}?imageView/1/w/100/h/100" class="goods-img pull-left w15 box-shadow"/>
                 {% else %}
                 <img src="/static/design_img/TDSG.png" class="goods-img pull-left w15 box-shadow"/>
                 {% end %}
                 <div class="w10 pull-right delete-btn">
                     <a href="javascript:;" class="pull-right delete-item"></a>
                 </div>
                 <div class="goods-info pull-right w75 font14 p010">
                     <p>
                         <span class="name pull-left">{{cart_m[key]['mcharge_type'].mgoods.name}}</span>
                         <span class="price pull-right">小记：<span class="item_total_price"></span>元</span>
                     </p>
                     <div class="charge-item">
                        <span class="col-sm-4  col-xs-4 text-bgcolor p0 charge-type" data-id="{{cart_m[key]['mcharge_type'].id}}">
                            <span class="item_price">{{cart_m[key]['mcharge_type'].price}}</span>
                            元/{{cart_m[key]['mcharge_type'].num}}
                            <span data-id="{{cart_m[key]['mcharge_type'].unit}}" class="chargeUnit"></span>
                        </span>
                        <span class="col-sm-6  col-xs-6  p0 number-change">
                            <a class="minus-plus text-orange bg-white pull-right number-plus" href="javascript:;">+</a>
                            <input type="text" value="{{cart_m[key]['num']}}" class="number-input pull-right text-orange item_number"/>
                            <a class="minus-plus text-orange bg-white pull-right number-minus" href="javascript:;">-</a>
                        </span>
                     </div>
                 </div>
             </div>
         </li>
         {% end %}
     </ul>
     <div class="bg-white bg-width center-block">
         <div class="clearfix font14 text-pink">
             <label class="pull-left">商品金额：</label>
             <span class="pull-right"><span id="list_total_price"></span>元</span>
         </div>
         <div class="clearfix font14 text-pink">
             <label class="pull-left">配送费：</label>
             <span class="pull-right"><span id="freight_money">{{config.freight_on_time}}</span>元</span>
         </div>
         <div class="clearfix font14 text-pink">
             <label class="pull-left">实付金额：</label>
             <span class="pull-right"><span id="final_price"></span>元</span>
         </div>
         <p class="text-center text-pink mincharge_intime" style="display:none">(抱歉，您的商品总金额未达到"按时达"起送价金额<span class="mincharge">{{config.min_charge_on_time}}</span>元)</p>
         <p class="text-center text-pink mincharge_now" style="display:none">(抱歉，您的商品总金额未达到"立即送"起送价金额<span class="mincharge">{{config.min_charge_now}}</span>元)</p>
         <div class="clearfix font16 text-center">
             {% set active=''%}
             {% set unactive=''%}
             {% if periods %}
                 {% set active='active'%}
                 {% set unactive=''%}
             {% else %}
                 {% set active=''%}
                 {% set unactive='active'%}
             {% end %}
             <ul id="sendType" class="send_type nav-pills  center-block">
                 <li data-id="2" class="{{active}} send-intime" data-config="{{config.ontime_on}}">
                     <a href="javascript:;" class="bg-white text-green" id="sendInTime">
                         <p>按时达</p>
                         <p class="font8">
                             起送价：{{config.min_charge_on_time or 0}}元
                             配送费：<span class="freigh_ontime">{{config.freight_on_time or 0}}</span>元
                         </p>
                     </a>
                 </li>
                 <li data-id="1" class="{{unactive}} send-now" data-config="{{config.now_on}}">
                     <a href="javascript:;" class="bg-white text-green" id="sendNow">
                         <p>立即送</p>
                         <p class="font8">
                             起送价：{{config.min_charge_now or 0}}元
                             配送费：<span class="freigh_now">{{config.freight_now or 0}}</span>元
                         </p>
                     </a>
                 </li>
             </ul>
         </div>
         <div class="send-time-choose clearfix center-block bg-grey2 box-style">
             <div class="bg-white  text-center">
                 <p>订单将根据您选择的时间段送达</p>
                 <p>合理选择收货时间段，保证订单能按时送达到您的手上</p>
             </div>
             {% if periods %}
             <ul id="sendDay" class="send_day nav-pills font16 clearfix text-center type-choose">
                 <li data-id="1" class="active" id="send_today"><a href="javascript:;" class="bg-white text-green">今天</a></li>
                 <li data-id="2" id="send_tomorrow"><a href="javascript:;" class="bg-white text-green">明天</a></li>
             </ul>
             <ul id="sendPeriod" class="send_period list-group font14 type-choose">
                 {% for period in periods%}
                 <li data-id="{{period.id}}" class="list-group-item">
                     <a href="javascript:;" class="text-grey">
                         <span class="text-grey3">{{period.name}}</span>
                         <p>
                             {{period.start_time}}~
                             <span class="intime_endtime">{{period.end_time}}</span>
                         </p>
                         <input type="hidden" class="intime_startHour" value="{{period.start_time.hour}}"/>
                         <input type="hidden" class="intime_startMin" value="{{period.start_time.minute}}"/>
                     </a>
                 </li>
                 {% end %}
             </ul>
             <input type="hidden" class="stop-range" value="{{config.stop_range}}"/>
             {% end %}
             <ul class="send_now list-group font14" style="display:none">
                 <li class="list-group-item">
                     送货时间：
                     <span class="now_startime">{{config.start_time_now}}</span>~
                     <span class="now_endtime">{{config.end_time_now}}</span>
                 </li>
             </ul>
         </div>
         <div class="send-address-choose clearfix center-block bg-grey2 box-style font14">
             <p>收货人地址</p>
             <ul id="addressType" class="address_list list-group type-choose">
                 {% for address in current_user.addresses%}
                 <li data-id="{{address.id}}" class="list-group-item clearfix item">
                     <a href="javascript:;" class="text-grey3 pull-left">
                         <span class="name pr10">{{address.receiver}}</span>
                         <span class="address pr10">{{address.address_text}}</span>
                         <span class="phone">{{address.phone}}</span>
                     </a>
                     <a class="text-green pull-right to-edit-address">+编辑收货地址</a>
                 </li>
                 {% end %}
             </ul>
             <a class="text-green pull-right to-add-address">+添加新收货地址</a>
             <div class="address-box hidden">
                 <input type="text" placeholder="输入收货人姓名" class="w-per9 center-block" id="receiveName"/>
                 <input type="text" placeholder="输入收货人详细地址"  class="w-per9 center-block" id="receiveAddress"/>
                 <input type="text" placeholder="输入收货人有效联系电话"  class="w-per9 center-block" id="receivePhone"/>
                 <div class="w-per9 center-block">
                     <button class="btn text-white bg-green pull-right" id="receiveAdd">确定</button>
                     <button class="btn text-white bg-green pull-right hidden" id="receiveEdit">确定</button>
                     <button class="btn text-grey3 bg-greyc pull-right m-r5" id="receiveCancel">取消</button>
                 </div>
             </div>
         </div>
         <div class="send-address-choose clearfix center-block bg-grey2 box-style font14">
             <p class="clearfix">
                 <span class="pull-left">支付方式</span>
                 <a href="#" class="text-green pull-right">充值</a>
                 <span class="pull-right pr10">账户余额：{{current_user.balance}}元</span>
             </p>
             <ul id="payType" class="pay_type list-group type-choose">
                 <li data-id="1" class="active list-group-item">
                     <a href="javascript:;" class="text-grey">
                         <span class="text-grey3">货到付款</span>
                         <p>送货员送货时交付现金</p>
                     </a>
                 </li>
                 <li data-id="2" class="list-group-item">
                     <a href="javascript:;" class="text-grey">
                         <span class="text-grey3">余额支付</span>
                         <p>提前支付</p>
                     </a>
                 </li>
             </ul>
         </div>
        <input id="messageCon" class="message-input input-sty box-style center-block font14" type="text" value="" placeholder="有什么想给我们留言的吗？">
        <button id="submitOrder" class="sub-btn w-per6 bg-green text-white text-center center-block btn">提交订单</button>
     </div>
    <div class="m-b60"></div>
{% end %}
{% block bottom %}
<script src="{{static_url('js/market-cart.js')}}"></script>
{% end %}
