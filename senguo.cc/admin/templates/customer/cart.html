{% extends 'base.html' %}
{% block title %}【{{shop_name}}】一家不错的O2O店铺，快来关注吧~{% end %}
{% block head %}
<link rel="stylesheet" href="{{static_url('css/market-cart.css')}}"/>
<link rel="stylesheet" href="{{static_url('css/fruit-color.css')}}"/>
{% end %}
{% block content %}
    <span id="shop_imgurl" data-img="{{shop_logo}}" data-code="{{shop_code}}"></span>
    <div class="rainshed bg_change fix-title"></div>
    <div class="anim-pulse bg-box">
        <ul class="cart-list set-w100-fle mt42 m-b0">
            {% for key in cart_f %}
            <li class="cart-list-item set-w100-fle fruit_item text-grey m-b5 {{cart_f[key]['code']}}">
                <div class="box bg set-w100-fle">
                    {% if cart_f[key]['charge_type'].fruit.img_url %}
                    <img src="/static/images/holder.png?v=20150330" class="goods-img pull-left w15 lazy_img" data-original="{{cart_f[key]['charge_type'].fruit.img_url}}?imageView/1/w/170/h/170"/>
                    {% else %}
                    <img src="/static/images/holder.png?v=20150330" class="goods-img pull-left w15 lazy_img" data-original="/static/design_img/{{cart_f[key]['charge_type'].fruit.fruit_type.code}}.png?v=20150316"/>
                    {% end %}
                    <div class="goods-info pull-left font14 p010">
                        <div class="clearfix">
                            <span class="name pull-left color">{{cart_f[key]['charge_type'].fruit.name}}</span>
                            <span class="price pull-left">￥<span class="item_total_price"></span>元</span>
                        </div>
                    <span class="p0 charge-type pull-left color" data-id="{{cart_f[key]['charge_type'].id}}">
                        <span class="item_price">{{cart_f[key]['charge_type'].price}}</span>
                        元/{{cart_f[key]['charge_type'].num}}
                        <span data-id="{{cart_f[key]['charge_type'].unit}}" class="chargeUnit"></span>
                    </span>
                    </div>
                    <div class="action-box font14">
                    <span class="pull-left number-change set-inl-blo">
                        <button class="minus-plus text-green  number-plus text-center font18 bg_change"></button>
                        <input type="text" value="{{cart_f[key]['num']}}" class="number-input item_number text-center bg_change" readonly/>
                        <button class="minus-plus text-green  number-minus text-center font18 bg_change"></button>
                    </span>
                        <div class="pull-right delete-btn">
                            <a href="javascript:;" class="pull-right delete-item text-center font18 text-grey">x</a>
                        </div>
                    </div>
                </div>
            </li>
            {% end %}
            {% for key in cart_m %}
            <li class="cart-list-item set-w100-fle menu_item TDSG text-grey m-b5">
                <div class="box bg set-w100-fle">
                    {% if cart_m[key]['mcharge_type'].mgoods.img_url %}
                    <img src="" class="goods-img pull-left w15 lazy_img" data-original="{{cart_m[key]['mcharge_type'].mgoods.img_url}}?imageView/1/w/170/h/170"/>
                    {% else %}
                    <img src="" class="goods-img pull-left w15 lazy_img" data-original="/static/design_img/TDSG.png?v=20150316"/>
                    {% end %}
                    <div class="goods-info pull-left font14 p010">
                        <div class="clearfix">
                            <span class="name pull-left color">{{cart_m[key]['mcharge_type'].mgoods.name}}</span>
                            <span class="price pull-left">￥<span class="item_total_price"></span>元</span>
                        </div>
                        <span class="p0 charge-type color" data-id="{{cart_m[key]['mcharge_type'].id}}">
                            <span class="item_price">{{cart_m[key]['mcharge_type'].price}}</span>
                                元/{{cart_m[key]['mcharge_type'].num}}
                             <span data-id="{{cart_m[key]['mcharge_type'].unit}}" class="chargeUnit"></span
                        </span>
                    </div>
                    <div class="action-box font14">
                        <span class="pull-left number-change set-inl-blo">
                            <a class="minus-plus text-green  number-plus text-center font18 bg_change" href="javascript:;"></a>
                            <input type="text" value="{{cart_m[key]['num']}}" class="number-input item_number text-center bg_change" readonly/>
                            <a class="minus-plus text-green  number-minus text-center font18 bg_change" href="javascript:;"></a>
                        </span>
                        <div class="pull-right delete-btn">
                            <a href="javascript:;" class="pull-right delete-item text-center font18 text-grey">x</a>
                        </div>
                    </div>
                 </div>
            </li>
            {% end %}
        </ul>
        <div class="bg-width center-block text-grey bg-white">
            <div class="clearfix font14 p010">
                <span class="pull-right tit2 text-right"><span id="list_total_price"></span>元</span>
                <span class="pull-right tit text-right">商品金额：</span>
            </div>
            <div class="clearfix font14 p010">
                <span class="pull-right tit2 text-right"><span id="freight_money">{{config.freight_on_time}}</span>元</span>
                <span class="pull-right tit text-right">配送费：</span>
            </div>
            <div class="clearfix m-b10 font14 p010 text-grey3">
                <span class="pull-right tit2 text-right"><span id="final_price"></span>元</span>
                <span class="pull-right tit text-right">实付金额：</span>
            </div>
            <p class="text-center text-pink mincharge_intime" style="display:none">┑(￣▽ ￣)┍ 您的商品总金额未达到“按时达”起送价金额<span class="mincharge">{{config.min_charge_on_time}}</span>元</p>
            <p class="text-center text-pink mincharge_now" style="display:none">┑(￣▽ ￣)┍ 您的商品总金额未达到“立即送”起送价金额<span class="mincharge">{{config.min_charge_now}}</span>元</p>
            <div class="send-time-choose clearfix center-block bg-white box-style">
                <p class="text-left text-grey9 font14 m-b5 pl10">收货时间</p>
                {% set active=''%}
                {% set unactive=''%}
                {% if periods %}
                {% set active='active'%}
                {% set unactive=''%}
                {% else %}
                {% set active=''%}
                {% set unactive='active'%}
                {% end %}
                <div id="sendType" class="send_type list-group">
                    {% if config.ontime_on == True%}
                    <button data-id="2" class="{{active}} send-intime  list-group-item item height50" data-config="{{config.ontime_on}}">
                        <a href="javascript:;" class="bg-white text-grey" id="sendInTime">
                            <span class="pull-left title set-inl-blo font14 line50">按时达</span>
                            <p class="text-grey9 title-right">
                                <span class="text-grey3">起送价：{{config.min_charge_on_time or 0}}元&nbsp;&nbsp;&nbsp;配送费：<span class="freigh_ontime">{{config.freight_on_time or 0}}</span>元</span>
                                <span class="mt3">根据选择的时间段送达</span>
                            </p>
                        </a>
                    </button>
                    {% end %}
                    {% if config.ontime_on == True%}
                    {% if periods %}
                    <div id="sendPeriod" class="send_period list-group font14">
                        <div class="arrow-top left70"></div>
                        <ul id="sendDay" class="send_day nav-pills clearfix text-center type-choose m-b10 font14 mt10">
                            <li data-id="1" class="active pull-left item" id="send_today"><a href="javascript:;" class="text-green">今天</a></li>
                            <li data-id="2" id="send_tomorrow" class="pull-left item"><a href="javascript:;" class="text-green">明天</a></li>
                        </ul>
                        <div id="sendPerTime" class="">
                        {% for period in periods%}
                            <button data-id="{{period.id}}" class="list-group-item clearfix available line50 height50 item">
                                <a href="javascript:;" class="text-grey clearfix">
                                    <a href="javascript:;" class="pull-right checkbox-btn"></a>
                                    <span class="text-grey3 pull-left set-inl-blo period_name text-left">{{period.name}}</span>
                             <span class="pull-left ontime-txt">
                                 <span class="check-time ontime-txt">{{period.start_time.hour}}</span> : <span class="check-time ontime-txt">{{period.start_time.minute}}</span> ~ <span class="intime_endtime ontime-txt"><span class="check-time ontime-txt">{{period.end_time.hour}}</span> : <span class="check-time ontime-txt">{{period.end_time.minute}}</span></span>
                             </span>
                                    <input type="hidden" class="intime_startHour" value="{{period.start_time.hour}}"/>
                                    <input type="hidden" class="intime_startMin" value="{{period.start_time.minute}}"/>
                                </a>
                            </button>
                        {% end %}
                        </div>
                    </div>
                    <input type="hidden" class="stop-range" value="{{config.stop_range}}"/>
                    {% end %}
                    {% end %}
                    {% if config.now_on == True%}
                    <button data-id="1" class="{{unactive}} send-now list-group-item item height50" data-config="{{config.now_on}}" >
                        <a href="javascript:;" class="bg-white text-grey" id="sendNow" data-period="{{config.intime_period or 0}}">
                            <span class="pull-left title set-inl-blo font14 line50">立即送</span>
                            <p class="text-grey9 title-right">
                                <span class="text-grey3">起送价：{{config.min_charge_now or 0}}元&nbsp;&nbsp;&nbsp;配送费：<span class="freigh_now">{{config.freight_now or 0}}</span>元</span>
                                <span class="mt3">{{config.intime_period or 0}}分钟内送到</span>
                            </p>
                        </a>
                    </button>
                    {% end %}
                </div>
                {% if config.now_on == True%}
                <ul class="send_now list-group" style="display:none">
                    <div class="arrow-top left82"></div>
                    <!-- <li class="list-group-item clearfix bg-grey2">
                         <p class="text-center text-pink">送货员太辛苦，打赏点小费吧\(╯▼╰)/ </p>
                         <ul class="tip-list font14">
                             <li class="btn text-green text-center bg-white pull-left" data-id="1">1元</li>
                             <li class="btn text-green text-center bg-white pull-left" data-id="2">2元</li>
                             <li class="btn text-green text-center bg-white pull-left" data-id="5">5元</li>
                         </ul>
                     </li>-->
                    <li class="font14 clearfix line50 height50">
                        送货时间：
                        <span class="now_startime">{{config.start_time_now}}</span> ~
                        <span class="now_endtime">{{config.end_time_now}}</span>
                    </li>
                </ul>
                {% end %}
            </div>
            <div class="send-address-choose clearfix center-block bg-white box-style">
                <p class="clearfix">
                    <span class="pull-left text-grey9 font14 m-b5 pl10">收货人地址</span>
                    <a class="text-green pull-right to-add-address font12 m-r10" href="javascript:;">+添加</a>
                </p>
                <ul id="addressType" class="address_list list-group type-choose font12 m-b5 clearfix">
                    {% for address in current_user.addresses%}
                    <li data-id="{{address.id}}" class="list-group-item clearfix item height50">
                        <a href="javascript:;" class="text-grey3 pull-left address">
                            <p class="mt5">
                                <span class="phone pr10">{{address.phone}}</span>
                                <span class="name">{{address.receiver}}</span>
                            </p>
                            <p class="address_con pr10 m0 text-grey9">{{address.address_text}}</p>
                        </a>
                        <a class="text-green pull-right to-edit-address text-center" href="javascript:;">+编辑</a>
                    </li>
                    {% end %}
                </ul>
                    <div class="address-box hidden set-w100-fle font12 p">
                        <div class="bg-grey2 p_10">
                            <p>
                                <span class="tit set-inl-blo pull-left">姓名：</span>
                                <input type="text" placeholder="输入收货人姓名" class="input-sty bg-white pull-left" id="receiveName"/>
                            </p>
                            <p>
                                <span class="tit set-inl-blo pull-left">地址：</span>
                                <input type="text" placeholder="输入收货人详细地址"  class="input-sty bg-white pull-left" id="receiveAddress"/>
                            </p>
                            <p>
                                <span class="tit set-inl-blo pull-left">电话：</span>
                                <input type="text" placeholder="输入收货人有效联系电话"  class="input-sty bg-white pull-left" id="receivePhone"/>
                            </p>
                            <div class="w118 center-block clearfix mt10">
                                <button class="btn text-white pull-right bg-green sure_btn" id="receiveAdd">确定</button>
                                <button class="btn text-white pull-right bg-green hidden sure_btn" id="receiveEdit">确定</button>
                                <button class="btn text-white bg-greyc pull-right m-r10" id="receiveCancel">取消</button>
                            </div>
                        </div>
                    </div>
            </div>
            <div class="send-address-choose clearfix center-block bg-white box-style">
                <p class="clearfix">
                    <span class="pull-left text-grey9 font14 m-b5 pl10">支付方式</span>
                    <span class="pull-right ">余额：{{balance_value}}元&nbsp;&nbsp;<a href="/customer/recharge" class="a-cz" data-auth="{{show_balance}}" data-status="{{config.balance_on_active}}">+充值</a></span>
                </p>
                <ul id="payType" class="pay_type list-group font12">
                    <li data-id="1" class="active list-group-item clearfix line50 height50 item" data-status="{{config.cash_on_active}}">
                        <a href="javascript:;" class="text-grey">
                            <span class="text-grey3 pull-left title set-inl-blo font14">货到付款</span>
                            <span class="pull-left text-grey9">先下单，收到商品时付款</span>
                        </a>
                    </li>
                   <li data-id="2" class="list-group-item clearfix line50 height50 item" id="balance-pay" data-auth="{{show_balance}}" data-status="{{config.balance_on_active}}">
	                    <a href="javascript:;" class="text-grey">
                            <span class="text-grey3 pull-left title set-inl-blo font14">余额支付</span>
                            <span class="pull-left text-grey9" style="max-width: 60%;">使用充值的余额极速下单</span>
                        </a>
                    </li>
                    <li data-id="3" class="list-group-item clearfix line50 height50 item" id="online-pay" data-type="wx" data-auth="{{show_balance}}" data-status="{{config.online_on_active}}">
                        <a href="javascript:;" class="text-grey">
                            <span class="text-grey3 pull-left title set-inl-blo font14">在线支付</span>
                            <span class="pull-left text-grey9" style="max-width: 60%;">下单的同时完成付款</span>
                        </a>
                    </li>
                </ul>
                <div class="group"></div>
                <div class="wrap-online-lst hidden">
                    <div class="arrow-top"></div>
                    <ul class="online-lst">
                        <li class="group" data-type="wx">
                            <a href="javascript:;" class="pull-right checkbox-btn checkboxed"></a>
                            <span class="pull-left w90"><img src="/static/images/wx_l.png" class="third-img" alt="微信支付"/></span>
                            <span class="pull-left text-grey9 third-txt">微信支付</span>
                        </li>
                        <li class="group" data-type="alipay">
                            <a href="javascript:;" class="pull-right checkbox-btn"></a>
                            <span class="pull-left w90"><img src="/static/images/alipay_l.png" class="third-img" alt="支付宝支付"/></span>
                            <span class="pull-left text-grey9 third-txt">支付宝支付</span>
                        </li>
                    </ul>
                </div>
            </div>
            <input id="messageCon" class="message-input input-sty box-style center-block font14 bg-white bg-grey" type="text" value="" placeholder="留个言调戏下客服吧？(⊙_⊙)">
            {% if config.text_message_active  == 1 and shop_new !=1 and current_user.accountinfo.phone == None %}
            <button  class="sub-btn w-per6 bg-grey99 text-white text-center center-block btn mt10 clearfix un_tie sure_btn">提交订单</button>
            <div class="first_notice center-block clearfix mt10">
                <span class="pull-left">第一次下单?</span>
                <button  class="sure_btn  text-center  pull-right" id="phoneNumber">绑定手机号</button>
            </div>
            {% else %}
             <button id="submitOrder" class="sub-btn w-per6 bg-green text-white text-center center-block btn mt10 clearfix sure_btn">提交订单</button>
            {% end %}
        </div>
        <div class="bottom-line"></div>
    </div>
{% end %}
{% block bottom %}
<div class="modal fade tie-popbox" id="tieBox">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-top"><img src="/static/images/info_top.png"/></div>
            <div class="modal-header set-width-float">
                <button type="button" class="close dismiss">✕</button>
                <h2 class="modal-title  text-center line48"></h2>
            </div>
            <div class="modal-body font14 clearfix">
                <div class="tie-info">
                    <div class="phone-number">
                        <input type="text" placeholder="请输入手机号" class="phone input1 pull-left" id="enterPhone"/>
                        <input type="submit" value="获取验证码" class="get-code pull-right bg-green3 sure_btn" id="getVrify"/>
                    </div>
                    <input type="text" placeholder="请输入收到的短信验证码" class="input1" id="enterVrify"/>
                </div>
            </div>
            <div class="modal-warn">
            </div>
            <div class="modal-footer clearfix">
                <button type="button" class="btn pull-right tie-btn bg-green3 sure_btn"  id="tiePhone">绑定</button>
            </div>
             <div class="modal-bottom"><img src="/static/images/info_bot.png"/></div>
        </div>
    </div>
</div>
<script src="{{static_url('js/market-cart.js')}}"></script>
{% end %}
